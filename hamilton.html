<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hamilton Depression Rating Scale (HDRS) - NeuroSense</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    :root {
      --primary-color: #2c3e50;
      --secondary-color: #3498db;
      --accent-color: #2980b9;
      --text-color: #333;
      --light-text: #fff;
      --card-bg: #fff;
      --section-bg: #f8f9fa;
      --border-color: #dee2e6;
      --normal-range: #27ae60;
      --mild-depression: #f1c40f;
      --moderate-depression: #e67e22;
      --severe-depression: #e74c3c;
      --very-severe: #c0392b;
      --clinical-threshold: #3498db;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: var(--section-bg);
      color: var(--text-color);
      line-height: 1.6;
    }
    
    .test-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    /* Header */
    .test-header {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      padding: 30px;
      border-radius: 15px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    }
    
    .test-header h1 {
      font-size: 2.2rem;
      margin-bottom: 10px;
    }
    
    .test-header .subtitle {
      font-size: 1.1rem;
      opacity: 0.9;
      margin-bottom: 15px;
    }
    
    .header-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .info-card {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 10px;
      backdrop-filter: blur(10px);
    }
    
    .info-card h4 {
      margin-bottom: 5px;
      font-size: 0.9rem;
      opacity: 0.8;
    }
    
    /* Instructions */
    .instructions-box {
      background: white;
      border-radius: 10px;
      padding: 25px;
      margin-bottom: 30px;
      border-left: 4px solid var(--primary-color);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }
    
    .instructions-box h3 {
      color: var(--primary-color);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .clinical-guidelines {
      background: #e3f2fd;
      border-left: 4px solid var(--secondary-color);
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }
    
    /* Scoring System */
    .scoring-system {
      background: white;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }
    
    .severity-scale {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 20px;
    }
    
    .scale-item {
      display: flex;
      align-items: center;
      padding: 12px 15px;
      border-radius: 8px;
      transition: all 0.3s;
    }
    
    .scale-item:hover {
      transform: translateX(5px);
    }
    
    .scale-range {
      min-width: 80px;
      font-weight: bold;
      text-align: center;
      padding: 5px 10px;
      border-radius: 5px;
      color: white;
    }
    
    .scale-description {
      flex: 1;
      padding-left: 20px;
    }
    
    /* Questions Container */
    .questions-container {
      background: white;
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
    }
    
    .question-section {
      margin-bottom: 40px;
      padding-bottom: 30px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .question-section:last-child {
      border-bottom: none;
    }
    
    .question-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--section-bg);
    }
    
    .question-number {
      background: var(--primary-color);
      color: white;
      width: 35px;
      height: 35px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.1rem;
    }
    
    .question-title {
      font-size: 1.2rem;
      color: var(--primary-color);
      font-weight: 600;
    }
    
    .question-text {
      color: #555;
      margin-bottom: 10px;
      padding-left: 10px;
      border-left: 3px solid var(--section-bg);
    }
    
    /* Response Options */
    .response-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 12px;
      margin-top: 20px;
    }
    
    .response-option {
      position: relative;
    }
    
    .option-btn {
      width: 100%;
      padding: 15px;
      text-align: left;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      background: white;
      color: var(--text-color);
      cursor: pointer;
      transition: all 0.3s;
      font-size: 0.95rem;
      line-height: 1.5;
      position: relative;
      padding-left: 50px;
    }
    
    .option-btn:hover {
      border-color: var(--secondary-color);
      transform: translateY(-2px);
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }
    
    .option-btn.selected {
      background: var(--secondary-color);
      color: white;
      border-color: var(--secondary-color);
      box-shadow: 0 5px 15px rgba(52, 152, 219, 0.2);
    }
    
    .option-score {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      width: 28px;
      height: 28px;
      background: var(--section-bg);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: var(--primary-color);
    }
    
    .option-btn.selected .option-score {
      background: white;
      color: var(--secondary-color);
    }
    
    /* Special Items */
    .suicide-item {
      background: #fff5f5;
      border: 2px solid #ffcdd2;
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
    }
    
    .weight-item {
      background: #f3e5f5;
      border: 2px solid #e1bee7;
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
    }
    
    /* Current Score Display */
    .score-display {
      position: sticky;
      top: 20px;
      background: white;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
      border: 2px solid var(--secondary-color);
      z-index: 100;
    }
    
    .current-score {
      font-size: 3rem;
      font-weight: bold;
      color: var(--secondary-color);
      text-align: center;
      margin: 10px 0;
    }
    
    .score-label {
      text-align: center;
      color: #666;
      margin-bottom: 10px;
    }
    
    /* Controls */
    .test-controls {
      display: flex;
      justify-content: space-between;
      gap: 20px;
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
    }
    
    .control-btn {
      padding: 12px 30px;
      border: none;
      border-radius: 25px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .prev-btn {
      background: var(--section-bg);
      color: #666;
    }
    
    .prev-btn:hover {
      background: #e9ecef;
    }
    
    .next-btn {
      background: var(--primary-color);
      color: white;
    }
    
    .next-btn:hover {
      background: var(--accent-color);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .submit-btn {
      background: linear-gradient(135deg, #27ae60, #2ecc71);
      color: white;
      padding: 15px 40px;
      font-size: 1.1rem;
    }
    
    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(39, 174, 96, 0.3);
    }
    
    /* Results Section */
    .results-container {
      display: none;
      background: white;
      border-radius: 15px;
      padding: 40px;
      margin-top: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
    }
    
    .results-header {
      text-align: center;
      margin-bottom: 40px;
    }
    
    .score-circle {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 30px;
      font-size: 3rem;
      font-weight: bold;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
    }
    
    .interpretation-box {
      background: var(--section-bg);
      padding: 25px;
      border-radius: 10px;
      margin: 30px 0;
      text-align: left;
    }
    
    .clinical-recommendations {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }
    
    .recommendation-card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      border-left: 4px solid var(--secondary-color);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }
    
    .recommendation-card h4 {
      color: var(--primary-color);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .item-breakdown {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin: 30px 0;
    }
    
    .item-card {
      padding: 15px;
      border-radius: 8px;
      background: white;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
      border-left: 4px solid var(--border-color);
    }
    
    .item-card h5 {
      color: var(--primary-color);
      margin-bottom: 8px;
      font-size: 0.9rem;
    }
    
    .item-score {
      font-size: 1.8rem;
      font-weight: bold;
      color: var(--secondary-color);
      text-align: center;
      margin: 10px 0;
    }
    
    /* Actions */
    .actions {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 40px;
    }
    
    .action-btn {
      padding: 12px 25px;
      border-radius: 25px;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s;
      border: none;
      cursor: pointer;
    }
    
    .retake-btn {
      background: var(--section-bg);
      color: #666;
    }
    
    .retake-btn:hover {
      background: #e9ecef;
    }
    
    .print-btn {
      background: var(--primary-color);
      color: white;
    }
    
    .print-btn:hover {
      background: var(--accent-color);
      transform: translateY(-2px);
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .test-container {
        padding: 15px;
      }
      
      .test-header {
        padding: 20px;
      }
      
      .test-header h1 {
        font-size: 1.8rem;
      }
      
      .header-info {
        grid-template-columns: 1fr;
      }
      
      .response-options {
        grid-template-columns: 1fr;
      }
      
      .test-controls {
        flex-direction: column;
      }
      
      .control-btn {
        width: 100%;
        justify-content: center;
      }
      
      .actions {
        flex-direction: column;
      }
      
      .action-btn {
        width: 100%;
        text-align: center;
      }
      
      .clinical-recommendations {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="test-container">
    <!-- Header -->
    <div class="test-header">
      <h1>Hamilton Depression Rating Scale (HDRS)</h1>
      <div class="subtitle">Clinician-Rated Assessment of Depression Severity</div>
      
      <div class="header-info">
        <div class="info-card">
          <h4>Administration Time</h4>
          <div>20-30 minutes</div>
        </div>
        <div class="info-card">
          <h4>Population</h4>
          <div>Adults</div>
        </div>
        <div class="info-card">
          <h4>Purpose</h4>
          <div>Assess severity and change in depressive symptoms</div>
        </div>
        <div class="info-card">
          <h4>Version</h4>
          <div>HDRS-17</div>
        </div>
      </div>
    </div>
    
    <!-- Instructions -->
    <div class="instructions-box">
      <h3><i class="fas fa-clipboard-list"></i> Administration Instructions</h3>
      <p><strong>PLEASE COMPLETE THE SCALE BASED ON A STRUCTURED INTERVIEW</strong></p>
      <p>For each item, select the one "cue" which best characterizes the patient based on symptoms experienced <strong>over the past week</strong>.</p>
      
      <div class="clinical-guidelines">
        <h4><i class="fas fa-stethoscope"></i> Clinical Guidelines</h4>
        <ul style="margin-left: 20px; margin-top: 10px;">
          <li>Conduct an unstructured clinical interview first</li>
          <li>Rate symptoms based on verbal report and observation</li>
          <li>Consider both frequency and intensity of symptoms</li>
          <li>Note: Designed for hospital inpatients with melancholic features</li>
        </ul>
      </div>
    </div>
    
    <!-- Scoring System -->
    <div class="scoring-system">
      <h3><i class="fas fa-chart-bar"></i> Interpretation Guidelines</h3>
      <div class="severity-scale">
        <div class="scale-item">
          <div class="scale-range" style="background: var(--normal-range);">0-7</div>
          <div class="scale-description">
            <strong>Normal Range / Clinical Remission</strong>
            <p style="font-size: 0.9rem; color: #666; margin-top: 5px;">Symptoms within normal limits or minimal depressive symptoms</p>
          </div>
        </div>
        
        <div class="scale-item">
          <div class="scale-range" style="background: var(--mild-depression);">8-13</div>
          <div class="scale-description">
            <strong>Mild Depression</strong>
            <p style="font-size: 0.9rem; color: #666; margin-top: 5px;">Noticeable symptoms but manageable impairment</p>
          </div>
        </div>
        
        <div class="scale-item">
          <div class="scale-range" style="background: var(--moderate-depression);">14-18</div>
          <div class="scale-description">
            <strong>Moderate Depression</strong>
            <p style="font-size: 0.9rem; color: #666; margin-top: 5px;">Significant symptoms affecting daily functioning</p>
          </div>
        </div>
        
        <div class="scale-item">
          <div class="scale-range" style="background: var(--severe-depression);">19-22</div>
          <div class="scale-description">
            <strong>Severe Depression</strong>
            <p style="font-size: 0.9rem; color: #666; margin-top: 5px;">Marked symptoms with substantial impairment</p>
          </div>
        </div>
        
        <div class="scale-item">
          <div class="scale-range" style="background: var(--very-severe);">23+</div>
          <div class="scale-description">
            <strong>Very Severe Depression</strong>
            <p style="font-size: 0.9rem; color: #666; margin-top: 5px;">Extreme symptoms requiring intensive treatment</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Current Score Display -->
    <div class="score-display" id="scoreDisplay">
      <div class="score-label">Current Total Score</div>
      <div class="current-score" id="currentScore">0</div>
      <div class="score-label" id="currentInterpretation">Normal Range</div>
    </div>
    
    <!-- Questions Container -->
    <div class="questions-container" id="questionsContainer">
      <!-- Questions will be dynamically inserted here -->
    </div>
    
    <!-- Test Controls -->
    <div class="test-controls" id="testControls">
      <button class="control-btn prev-btn" id="prevBtn" onclick="prevSection()">
        <i class="fas fa-arrow-left"></i> Previous
      </button>
      <button class="control-btn next-btn" id="nextBtn" onclick="nextSection()">
        Next <i class="fas fa-arrow-right"></i>
      </button>
      <button class="control-btn submit-btn" id="submitBtn" onclick="submitAssessment()">
        <i class="fas fa-paper-plane"></i> Complete Assessment
      </button>
    </div>
    
    <!-- Results Section -->
    <div class="results-container" id="resultsContainer">
      <div class="results-header">
        <i class="fas fa-clipboard-check" style="font-size: 3rem; color: var(--primary-color); margin-bottom: 20px;"></i>
        <h2>Hamilton Depression Rating Scale Results</h2>
        <p>Clinician-Rated Assessment of Depression Severity</p>
      </div>
      
      <div class="score-circle" id="finalScoreCircle">0</div>
      
      <div class="interpretation-box">
        <h3><i class="fas fa-diagnoses"></i> Clinical Interpretation</h3>
        <p id="interpretationText">Based on the structured interview and observation, the patient's depression severity has been assessed.</p>
        <div style="margin-top: 20px; padding: 15px; background: white; border-radius: 8px;">
          <strong>Clinical Trial Threshold:</strong> Scores of 20+ are usually required for entry into clinical trials.
        </div>
      </div>
      
      <!-- Item Breakdown -->
      <h3 style="margin: 30px 0 20px 0;"><i class="fas fa-list-ol"></i> Item-by-Item Breakdown</h3>
      <div class="item-breakdown" id="itemBreakdown">
        <!-- Will be dynamically filled -->
      </div>
      
      <!-- Clinical Recommendations -->
      <h3 style="margin: 30px 0 20px 0;"><i class="fas fa-prescription-bottle-alt"></i> Clinical Recommendations</h3>
      <div class="clinical-recommendations" id="clinicalRecommendations">
        <!-- Will be dynamically filled -->
      </div>
      
      <!-- Actions -->
      <div class="actions">
        <button class="action-btn retake-btn" onclick="retakeAssessment()">
          <i class="fas fa-redo"></i> New Assessment
        </button>
        <button class="action-btn print-btn" onclick="printResults()">
          <i class="fas fa-print"></i> Print Results
        </button>
      </div>
    </div>
  </div>

  <script>
    // HDRS Items Data (17 items)
    const hdrsItems = [
      {
        id: 1,
        title: "Depressed Mood",
        description: "Sadness, hopeless, helpless, worthless",
        options: [
          { score: 0, text: "Absent." },
          { score: 1, text: "These feeling states indicated only on questioning." },
          { score: 2, text: "These feeling states spontaneously reported verbally." },
          { score: 3, text: "Communicates feeling states non-verbally (facial expression, posture, voice, tendency to weep)." },
          { score: 4, text: "Patient reports virtually only these feeling states in spontaneous verbal and non-verbal communication." }
        ]
      },
      {
        id: 2,
        title: "Feelings of Guilt",
        description: "",
        options: [
          { score: 0, text: "Absent." },
          { score: 1, text: "Self reproach, feels he/she has let people down." },
          { score: 2, text: "Ideas of guilt or rumination over past errors or sinful deeds." },
          { score: 3, text: "Present illness is a punishment. Delusions of guilt." },
          { score: 4, text: "Hears accusatory or denunciatory voices and/or experiences threatening visual hallucinations." }
        ]
      },
      {
        id: 3,
        title: "Suicide",
        description: "",
        isCritical: true,
        options: [
          { score: 0, text: "Absent." },
          { score: 1, text: "Feels life is not worth living." },
          { score: 2, text: "Wishes he/she were dead or any thoughts of possible death to self." },
          { score: 3, text: "Ideas or gestures of suicide." },
          { score: 4, text: "Attempts at suicide (any serious attempt rate 4)." }
        ]
      },
      {
        id: 4,
        title: "Insomnia: Early in the Night",
        description: "Difficulty falling asleep",
        options: [
          { score: 0, text: "No difficulty falling asleep." },
          { score: 1, text: "Complains of occasional difficulty falling asleep (i.e., more than 1/2 hour)." },
          { score: 2, text: "Complains of nightly difficulty falling asleep." }
        ]
      },
      {
        id: 5,
        title: "Insomnia: Middle of the Night",
        description: "Restlessness and disturbed sleep",
        options: [
          { score: 0, text: "No difficulty." },
          { score: 1, text: "Patient complains of being restless and disturbed during the night." },
          { score: 2, text: "Waking during the night - any getting out of bed rates 2 (except for purposes of voiding)." }
        ]
      },
      {
        id: 6,
        title: "Insomnia: Early Hours of the Morning",
        description: "Early morning awakening",
        options: [
          { score: 0, text: "No difficulty." },
          { score: 1, text: "Waking in early hours of the morning but goes back to sleep." },
          { score: 2, text: "Unable to fall asleep again if he/she gets out of bed." }
        ]
      },
      {
        id: 7,
        title: "Work and Activities",
        description: "",
        options: [
          { score: 0, text: "No difficulty." },
          { score: 1, text: "Thoughts and feelings of incapacity, fatigue or weakness related to activities, work or hobbies." },
          { score: 2, text: "Loss of interest in activity, hobbies or work - either directly reported or indirect in listlessness, indecision and vacillation." },
          { score: 3, text: "Decrease in actual time spent in activities or decrease in productivity (less than 3 hours/day excluding routine chores)." },
          { score: 4, text: "Stopped working because of present illness. Engages in no activities except routine chores, or fails to perform routine chores unassisted." }
        ]
      },
      {
        id: 8,
        title: "Retardation",
        description: "Slowness of thought and speech, impaired ability to concentrate, decreased motor activity",
        options: [
          { score: 0, text: "Normal speech and thought." },
          { score: 1, text: "Slight retardation during the interview." },
          { score: 2, text: "Obvious retardation during the interview." },
          { score: 3, text: "Interview difficult." },
          { score: 4, text: "Complete stupor." }
        ]
      },
      {
        id: 9,
        title: "Agitation",
        description: "",
        options: [
          { score: 0, text: "None." },
          { score: 1, text: "Fidgetiness." },
          { score: 2, text: "Playing with hands, hair, etc." },
          { score: 3, text: "Moving about, can't sit still." },
          { score: 4, text: "Hand wringing, nail biting, hair-pulling, biting of lips." }
        ]
      },
      {
        id: 10,
        title: "Anxiety Psychic",
        description: "",
        options: [
          { score: 0, text: "No difficulty." },
          { score: 1, text: "Subjective tension and irritability." },
          { score: 2, text: "Worrying about minor matters." },
          { score: 3, text: "Apprehensive attitude apparent in face or speech." },
          { score: 4, text: "Fears expressed without questioning." }
        ]
      },
      {
        id: 11,
        title: "Anxiety Somatic",
        description: "Physiological concomitants of anxiety (GI, cardiovascular, respiratory, urinary frequency, sweating)",
        options: [
          { score: 0, text: "Absent." },
          { score: 1, text: "Mild." },
          { score: 2, text: "Moderate." },
          { score: 3, text: "Severe." },
          { score: 4, text: "Incapacitating." }
        ]
      },
      {
        id: 12,
        title: "Somatic Symptoms Gastro-intestinal",
        description: "",
        options: [
          { score: 0, text: "None." },
          { score: 1, text: "Loss of appetite but eating without staff encouragement. Heavy feelings in abdomen." },
          { score: 2, text: "Difficulty eating without staff urging. Requests or requires laxatives or medication for GI symptoms." }
        ]
      },
      {
        id: 13,
        title: "General Somatic Symptoms",
        description: "",
        options: [
          { score: 0, text: "None." },
          { score: 1, text: "Heaviness in limbs, back or head. Backaches, headaches, muscle aches. Loss of energy and fatigability." },
          { score: 2, text: "Any clear-cut symptom rates 2." }
        ]
      },
      {
        id: 14,
        title: "Genital Symptoms",
        description: "Loss of libido, menstrual disturbances",
        options: [
          { score: 0, text: "Absent." },
          { score: 1, text: "Mild." },
          { score: 2, text: "Severe." }
        ]
      },
      {
        id: 15,
        title: "Hypochondriasis",
        description: "",
        options: [
          { score: 0, text: "Not present." },
          { score: 1, text: "Self-absorption (bodily)." },
          { score: 2, text: "Preoccupation with health." },
          { score: 3, text: "Frequent complaints, requests for help, etc." },
          { score: 4, text: "Hypochondriacal delusions." }
        ]
      },
      {
        id: 16,
        title: "Loss of Weight",
        description: "",
        isWeightItem: true,
        options: [
          { score: 0, text: "No weight loss / Less than 1 lb weight loss in week." },
          { score: 1, text: "Probable weight loss associated with present illness / Greater than 1 lb weight loss in week." },
          { score: 2, text: "Definite weight loss / Greater than 2 lb weight loss in week." },
          { score: 3, text: "Not assessed." }
        ]
      },
      {
        id: 17,
        title: "Insight",
        description: "",
        options: [
          { score: 0, text: "Acknowledges being depressed and ill." },
          { score: 1, text: "Acknowledges illness but attributes cause to bad food, climate, overwork, virus, need for rest, etc." },
          { score: 2, text: "Denies being ill at all." }
        ]
      }
    ];

    // User responses
    let userResponses = new Array(hdrsItems.length).fill(null);
    let currentSection = 0;

    // Initialize on load
    document.addEventListener('DOMContentLoaded', function() {
      renderSection();
      updateScoreDisplay();
    });

    // Render current section
    function renderSection() {
      const container = document.getElementById('questionsContainer');
      const section = hdrsItems[currentSection];
      
      // Special styling for critical items
      const sectionClass = section.isCritical ? 'suicide-item' : 
                          section.isWeightItem ? 'weight-item' : '';
      
      const optionsHTML = section.options.map(option => `
        <div class="response-option">
          <button class="option-btn ${userResponses[currentSection] === option.score ? 'selected' : ''}" 
                  onclick="selectResponse(${option.score})">
            <span class="option-score">${option.score}</span>
            ${option.text}
          </button>
        </div>
      `).join('');
      
      container.innerHTML = `
        <div class="question-section ${sectionClass}">
          <div class="question-header">
            <div class="question-number">${section.id}</div>
            <div class="question-title">${section.title}</div>
          </div>
          
          ${section.description ? `
            <div class="question-text">
              <strong>${section.description}</strong>
            </div>
          ` : ''}
          
          ${section.isCritical ? `
            <div style="margin: 15px 0; padding: 10px; background: #ffebee; border-radius: 5px; border-left: 4px solid #f44336;">
              <i class="fas fa-exclamation-triangle"></i>
              <strong> Critical Item:</strong> If score is 2 or higher, immediate safety assessment is recommended.
            </div>
          ` : ''}
          
          <div class="response-options">
            ${optionsHTML}
          </div>
        </div>
      `;

      // Update navigation buttons
      updateNavigation();
    }

    // Select response
    function selectResponse(score) {
      userResponses[currentSection] = score;
      renderSection();
      updateScoreDisplay();
    }

    // Update navigation buttons
    function updateNavigation() {
      document.getElementById('prevBtn').style.display = currentSection === 0 ? 'none' : 'flex';
      document.getElementById('nextBtn').style.display = currentSection === hdrsItems.length - 1 ? 'none' : 'flex';
      document.getElementById('submitBtn').style.display = currentSection === hdrsItems.length - 1 ? 'flex' : 'none';
    }

    // Next section
    function nextSection() {
      if (currentSection < hdrsItems.length - 1) {
        currentSection++;
        renderSection();
        updateScoreDisplay();
      }
    }

    // Previous section
    function prevSection() {
      if (currentSection > 0) {
        currentSection--;
        renderSection();
        updateScoreDisplay();
      }
    }

    // Calculate total score
    function calculateTotalScore() {
      return userResponses.reduce((total, score) => {
        return total + (score !== null ? score : 0);
      }, 0);
    }

    // Get interpretation
    function getInterpretation(score) {
      if (score <= 7) {
        return {
          level: "Normal Range / Clinical Remission",
          description: "Symptoms are within normal limits or represent minimal depressive symptoms. Consider monitoring if there is a history of depression.",
          color: "#27ae60",
          recommendations: [
            "Continue routine clinical monitoring",
            "Maintain current treatment if applicable",
            "Educate about early warning signs of recurrence"
          ]
        };
      } else if (score <= 13) {
        return {
          level: "Mild Depression",
          description: "Noticeable depressive symptoms present but with manageable impairment in functioning.",
          color: "#f1c40f",
          recommendations: [
            "Consider psychotherapy (CBT, IPT)",
            "Psychoeducation about depression",
            "Regular follow-up in 2-4 weeks",
            "Monitor for symptom progression"
          ]
        };
      } else if (score <= 18) {
        return {
          level: "Moderate Depression",
          description: "Significant depressive symptoms affecting daily functioning. Clinical intervention is indicated.",
          color: "#e67e22",
          recommendations: [
            "Initiate evidence-based psychotherapy",
            "Consider antidepressant medication",
            "Weekly to bi-weekly monitoring",
            "Functional impairment assessment"
          ]
        };
      } else if (score <= 22) {
        return {
          level: "Severe Depression",
          description: "Marked depressive symptoms with substantial impairment in social and occupational functioning.",
          color: "#e74c3c",
          recommendations: [
            "Initiate antidepressant medication",
            "Combination therapy (medication + psychotherapy)",
            "Close monitoring (weekly)",
            "Assess need for higher level of care"
          ]
        };
      } else {
        return {
          level: "Very Severe Depression",
          description: "Extreme depressive symptoms requiring intensive treatment and close monitoring.",
          color: "#c0392b",
          recommendations: [
            "Immediate treatment initiation",
            "Consider psychiatric hospitalization",
            "Combination treatment mandatory",
            "Daily to weekly monitoring",
            "Safety assessment and planning"
          ]
        };
      }
    }

    // Update score display
    function updateScoreDisplay() {
      const score = calculateTotalScore();
      const interpretation = getInterpretation(score);
      
      document.getElementById('currentScore').textContent = score;
      document.getElementById('currentInterpretation').textContent = interpretation.level;
      document.getElementById('currentInterpretation').style.color = interpretation.color;
      
      // Update progress indicator
      const progress = (score / 52) * 100; // Max possible score is 52
      document.getElementById('scoreDisplay').style.background = `
        linear-gradient(90deg, 
          ${interpretation.color}20 ${progress}%, 
          white ${progress}%
        )
      `;
    }

    // Get suicide risk assessment
    function getSuicideAssessment() {
      const suicideScore = userResponses[2]; // Item 3 (index 2)
      
      if (suicideScore === null || suicideScore === 0) {
        return {
          level: "No Current Risk",
          description: "No suicidal ideation reported during assessment.",
          critical: false
        };
      } else if (suicideScore === 1) {
        return {
          level: "Passive Suicidal Ideation",
          description: "Patient reports life not worth living but no active suicidal thoughts.",
          critical: true
        };
      } else if (suicideScore === 2) {
        return {
          level: "Active Suicidal Ideation",
          description: "Patient reports wishing to be dead or thoughts of death to self.",
          critical: true
        };
      } else if (suicideScore === 3) {
        return {
          level: "Suicidal Gestures or Plans",
          description: "Patient reports suicidal ideas or gestures.",
          critical: true
        };
      } else {
        return {
          level: "Suicide Attempt",
          description: "Patient has made suicide attempt(s). Requires immediate intervention.",
          critical: true
        };
      }
    }

    // Submit assessment
    function submitAssessment() {
      const unanswered = userResponses.filter(r => r === null).length;
      if (unanswered > 0) {
        alert(`Please complete all items before submitting. ${unanswered} item(s) remaining.`);
        return;
      }

      const totalScore = calculateTotalScore();
      const interpretation = getInterpretation(totalScore);
      const suicideAssessment = getSuicideAssessment();
      
      // Display final score
      document.getElementById('finalScoreCircle').textContent = totalScore;
      document.getElementById('finalScoreCircle').style.background = interpretation.color;
      
      // Update interpretation text
      document.getElementById('interpretationText').innerHTML = `
        <strong>${interpretation.level}:</strong> ${interpretation.description}
        <div style="margin-top: 15px; font-size: 0.9rem; color: #666;">
          Total Score: <strong>${totalScore}/52</strong> (maximum possible score)
        </div>
      `;
      
      // Generate item breakdown
      generateItemBreakdown();
      
      // Generate recommendations
      generateRecommendations(interpretation, suicideAssessment);
      
      // Show results
      document.getElementById('questionsContainer').style.display = 'none';
      document.getElementById('testControls').style.display = 'none';
      document.getElementById('scoreDisplay').style.display = 'none';
      document.getElementById('resultsContainer').style.display = 'block';
      
      // Save to localStorage
      saveAssessmentResults(totalScore, interpretation, suicideAssessment);
    }

    // Generate item breakdown
    function generateItemBreakdown() {
      const container = document.getElementById('itemBreakdown');
      let html = '';
      
      hdrsItems.forEach((item, index) => {
        const score = userResponses[index] !== null ? userResponses[index] : 0;
        const maxScore = Math.max(...item.options.map(o => o.score));
        
        html += `
          <div class="item-card">
            <h5>${item.id}. ${item.title}</h5>
            <div class="item-score">${score}/${maxScore}</div>
            <div style="font-size: 0.8rem; color: #666;">
              ${item.options.find(o => o.score === score)?.text.substring(0, 60)}...
            </div>
          </div>
        `;
      });
      
      container.innerHTML = html;
    }

    // Generate recommendations
    function generateRecommendations(interpretation, suicideAssessment) {
      const container = document.getElementById('clinicalRecommendations');
      let recommendations = [...interpretation.recommendations];
      
      // Add suicide-specific recommendations if needed
      if (suicideAssessment.critical) {
        recommendations.unshift({
          title: "Safety Assessment",
          icon: "fas fa-shield-alt",
          text: `<strong>${suicideAssessment.level}:</strong> ${suicideAssessment.description} Conduct immediate safety assessment and develop safety plan.`
        });
        
        if (userResponses[2] >= 3) { // Score 3 or 4 on suicide item
          recommendations.unshift({
            title: "Emergency Intervention",
            icon: "fas fa-ambulance",
            text: "Requires immediate psychiatric evaluation. Consider emergency department referral or crisis intervention."
          });
        }
      }
      
      // Add general clinical recommendations
      recommendations.push(
        {
          title: "Follow-up Assessment",
          icon: "fas fa-calendar-check",
          text: "Re-administer HDRS in 4-6 weeks to monitor treatment response and symptom changes."
        },
        {
          title: "Comprehensive Evaluation",
          icon: "fas fa-clipboard-check",
          text: "Consider additional assessments: BDI-II for self-report, clinical interview for comorbid conditions."
        },
        {
          title: "Documentation",
          icon: "fas fa-file-medical",
          text: "Document assessment results, clinical impressions, and treatment plan in patient record."
        }
      );
      
      // Render recommendations
      container.innerHTML = recommendations.map(rec => `
        <div class="recommendation-card">
          <h4><i class="${rec.icon}"></i> ${rec.title}</h4>
          <p>${rec.text}</p>
        </div>
      `).join('');
    }

    // Save assessment results
    function saveAssessmentResults(totalScore, interpretation, suicideAssessment) {
      const assessmentData = {
        test: "Hamilton Depression Rating Scale (HDRS-17)",
        date: new Date().toISOString(),
        totalScore: totalScore,
        interpretation: interpretation.level,
        suicideRisk: suicideAssessment.level,
        items: hdrsItems.map((item, index) => ({
          id: item.id,
          title: item.title,
          score: userResponses[index],
          maxScore: Math.max(...item.options.map(o => o.score))
        })),
        clinicalThresholds: {
          normal: "0-7",
          mild: "8-13",
          moderate: "14-18",
          severe: "19-22",
          verySevere: "23+",
          clinicalTrial: "20+"
        }
      };
      
      // Save to localStorage
      const assessments = JSON.parse(localStorage.getItem('hdrsAssessments') || '[]');
      assessments.push(assessmentData);
      localStorage.setItem('hdrsAssessments', JSON.stringify(assessments));
    }

    // Retake assessment
    function retakeAssessment() {
      userResponses = new Array(hdrsItems.length).fill(null);
      currentSection = 0;
      
      document.getElementById('questionsContainer').style.display = 'block';
      document.getElementById('testControls').style.display = 'flex';
      document.getElementById('scoreDisplay').style.display = 'block';
      document.getElementById('resultsContainer').style.display = 'none';
      
      renderSection();
      updateScoreDisplay();
    }

    // Print results
    function printResults() {
      const printContent = document.getElementById('resultsContainer').innerHTML;
      const originalContent = document.body.innerHTML;
      
      document.body.innerHTML = `
        <div style="padding: 40px; font-family: Arial, sans-serif;">
          <h1 style="color: #2c3e50; margin-bottom: 20px;">Hamilton Depression Rating Scale Results</h1>
          <div style="margin-bottom: 30px; color: #666;">
            Assessment Date: ${new Date().toLocaleDateString()}
          </div>
          ${printContent}
        </div>
      `;
      
      window.print();
      document.body.innerHTML = originalContent;
      location.reload();
    }

    // Keyboard navigation
    document.addEventListener('keydown', function(event) {
      if (event.key === 'ArrowRight' || event.key === ' ') {
        event.preventDefault();
        nextSection();
      } else if (event.key === 'ArrowLeft') {
        event.preventDefault();
        prevSection();
      } else if (event.key >= '0' && event.key <= '4') {
        event.preventDefault();
        const score = parseInt(event.key);
        const currentItem = hdrsItems[currentSection];
        if (currentItem.options.some(option => option.score === score)) {
          selectResponse(score);
        }
      }
    });
  </script>
</body>
</html>