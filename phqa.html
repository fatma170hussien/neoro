<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PHQ-A - Patient Health Questionnaire for Adolescents</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    :root {
      --primary-color: #0288d1;
      --secondary-color: #03a9f4;
      --accent-color: #0288d1;
      --text-color: #333;
      --light-text: #fff;
      --card-bg: #fff;
      --section-bg: #e1f5fe;
      --border-color: #b3e5fc;
      --none: #4caf50;
      --minimal: #8bc34a;
      --mild: #ffc107;
      --moderate: #ff9800;
      --mod-severe: #ff5722;
      --severe: #f44336;
      --clinical-threshold: #e91e63;
      --critical-color: #d32f2f;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: var(--section-bg);
      color: var(--text-color);
      line-height: 1.6;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }
    
    /* Header */
    .header {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      padding: 25px;
      border-radius: 12px;
      margin-bottom: 25px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      position: relative;
      overflow: hidden;
    }
    
    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #ff9800, #ff5722);
    }
    
    .header h1 {
      font-size: 2rem;
      margin-bottom: 5px;
      font-weight: 600;
    }
    
    .header .subtitle {
      font-size: 1rem;
      opacity: 0.9;
      margin-bottom: 15px;
    }
    
    .demographics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .demo-card {
      background: rgba(255, 255, 255, 0.1);
      padding: 12px;
      border-radius: 8px;
      backdrop-filter: blur(10px);
    }
    
    .demo-card h4 {
      font-size: 0.85rem;
      opacity: 0.8;
      margin-bottom: 5px;
    }
    
    .demo-input {
      width: 100%;
      padding: 8px;
      border: none;
      border-radius: 5px;
      background: rgba(255, 255, 255, 0.9);
      color: var(--text-color);
      font-size: 1rem;
    }
    
    /* Instructions */
    .instructions {
      background: white;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 25px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      border-left: 4px solid var(--accent-color);
    }
    
    .instructions h3 {
      color: var(--primary-color);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .time-frame {
      background: #e8f5e9;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
      border-left: 4px solid #4caf50;
    }
    
    .time-frame h4 {
      color: #388e3c;
      margin-bottom: 10px;
    }
    
    /* Current Score Display */
    .score-display {
      position: sticky;
      top: 10px;
      background: white;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      border: 2px solid var(--primary-color);
      z-index: 100;
    }
    
    .score-value {
      font-size: 2.2rem;
      font-weight: bold;
      color: var(--primary-color);
      text-align: center;
      margin: 5px 0;
    }
    
    .score-label {
      text-align: center;
      color: #666;
      font-size: 0.9rem;
    }
    
    .progress-bar {
      height: 8px;
      background: var(--section-bg);
      border-radius: 4px;
      margin-top: 10px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
      width: 0%;
      transition: width 0.3s ease;
      border-radius: 4px;
    }
    
    /* Items Container */
    .items-container {
      background: white;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
    }
    
    .item-group {
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .item-group:last-child {
      border-bottom: none;
    }
    
    .item-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      background: var(--section-bg);
      color: var(--primary-color);
      border-radius: 50%;
      font-weight: bold;
      margin-bottom: 15px;
      font-size: 1rem;
    }
    
    .item-text {
      font-size: 1.05rem;
      color: var(--text-color);
      margin-bottom: 15px;
      font-weight: 500;
      line-height: 1.5;
    }
    
    /* Response Grid */
    .response-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top: 15px;
    }
    
    @media (max-width: 768px) {
      .response-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    @media (max-width: 480px) {
      .response-grid {
        grid-template-columns: 1fr;
      }
    }
    
    .response-option {
      position: relative;
    }
    
    .option-btn {
      width: 100%;
      padding: 15px 10px;
      text-align: center;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      background: white;
      color: var(--text-color);
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.9rem;
      line-height: 1.4;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
    }
    
    .option-btn:hover {
      border-color: var(--accent-color);
      transform: translateY(-2px);
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }
    
    .option-btn.selected {
      background: linear-gradient(135deg, var(--section-bg), white);
      border-color: var(--accent-color);
      box-shadow: 0 4px 12px rgba(3, 155, 229, 0.15);
    }
    
    .option-score {
      font-size: 1.2rem;
      font-weight: bold;
      color: var(--primary-color);
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--section-bg);
    }
    
    .option-btn.selected .option-score {
      background: var(--accent-color);
      color: white;
    }
    
    .option-label {
      font-size: 0.85rem;
      font-weight: 500;
      text-align: center;
    }
    
    /* Critical Items */
    .critical-item {
      background: #ffebee;
      border: 2px solid #ffcdd2;
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
    }
    
    .suicide-warning {
      background: #fff3e0;
      border-left: 4px solid #ff9800;
      padding: 12px;
      border-radius: 6px;
      margin-top: 10px;
      font-size: 0.9rem;
    }
    
    /* Additional Questions */
    .additional-questions {
      background: white;
      border-radius: 10px;
      padding: 20px;
      margin: 25px 0;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    
    .additional-question {
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .additional-question:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    
    .question-text {
      font-size: 1rem;
      color: var(--primary-color);
      margin-bottom: 12px;
      font-weight: 500;
    }
    
    .option-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
    }
    
    .additional-option {
      padding: 10px;
      border: 2px solid var(--border-color);
      border-radius: 6px;
      background: white;
      color: var(--text-color);
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
      font-size: 0.9rem;
    }
    
    .additional-option:hover {
      border-color: var(--accent-color);
    }
    
    .additional-option.selected {
      background: var(--section-bg);
      border-color: var(--accent-color);
      font-weight: 500;
    }
    
    /* Controls */
    .controls {
      display: flex;
      justify-content: space-between;
      gap: 15px;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
    }
    
    .control-btn {
      padding: 12px 25px;
      border: none;
      border-radius: 25px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .prev-btn {
      background: var(--section-bg);
      color: #666;
    }
    
    .prev-btn:hover {
      background: #e0e0e0;
    }
    
    .next-btn {
      background: var(--primary-color);
      color: white;
    }
    
    .next-btn:hover {
      background: var(--accent-color);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .submit-btn {
      background: linear-gradient(135deg, #00c853, #64dd17);
      color: white;
      padding: 14px 35px;
      font-size: 1rem;
    }
    
    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0, 200, 83, 0.3);
    }
    
    /* Results */
    .results-container {
      display: none;
      background: white;
      border-radius: 12px;
      padding: 35px;
      margin-top: 25px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
    }
    
    .results-header {
      text-align: center;
      margin-bottom: 35px;
    }
    
    .final-score-circle {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin: 0 auto 25px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    }
    
    .score-number {
      font-size: 2.8rem;
      font-weight: bold;
      line-height: 1;
    }
    
    .score-total {
      font-size: 1rem;
      opacity: 0.9;
      margin-top: 5px;
    }
    
    .interpretation {
      background: var(--section-bg);
      padding: 20px;
      border-radius: 10px;
      margin: 25px 0;
    }
    
    .severity-scale {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin: 25px 0;
    }
    
    .severity-card {
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      transition: transform 0.3s;
    }
    
    .severity-card:hover {
      transform: translateY(-5px);
    }
    
    .severity-range {
      font-size: 1.4rem;
      font-weight: bold;
      margin-bottom: 8px;
    }
    
    .severity-label {
      font-size: 0.9rem;
      font-weight: 600;
    }
    
    .symptom-analysis {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin: 25px 0;
    }
    
    .symptom-card {
      padding: 15px;
      border-radius: 8px;
      background: white;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
      border-left: 4px solid var(--border-color);
    }
    
    .symptom-card h5 {
      color: var(--primary-color);
      margin-bottom: 8px;
      font-size: 0.9rem;
    }
    
    .symptom-score {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--accent-color);
      text-align: center;
      margin: 10px 0;
    }
    
    .recommendations-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 25px;
    }
    
    .recommendation-card {
      background: white;
      padding: 18px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      border-left: 4px solid var(--primary-color);
    }
    
    .recommendation-card h4 {
      color: var(--primary-color);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1rem;
    }
    
    /* Actions */
    .actions {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 30px;
    }
    
    .action-btn {
      padding: 12px 25px;
      border-radius: 25px;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s;
      border: none;
      cursor: pointer;
    }
    
    .retake-btn {
      background: var(--section-bg);
      color: #666;
    }
    
    .retake-btn:hover {
      background: #e0e0e0;
    }
    
    .print-btn {
      background: var(--primary-color);
      color: white;
    }
    
    .print-btn:hover {
      background: var(--accent-color);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      
      .header {
        padding: 20px;
      }
      
      .header h1 {
        font-size: 1.7rem;
      }
      
      .demographics {
        grid-template-columns: 1fr;
      }
      
      .response-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .controls {
        flex-direction: column;
      }
      
      .control-btn {
        width: 100%;
        justify-content: center;
      }
      
      .actions {
        flex-direction: column;
      }
      
      .action-btn {
        width: 100%;
        text-align: center;
      }
      
      .severity-scale,
      .symptom-analysis,
      .recommendations-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>PHQ-9 Modified for Adolescents (PHQ-A)</h1>
      <div class="subtitle">Patient Health Questionnaire for Depression Screening</div>
      
      <div class="demographics">
        <div class="demo-card">
          <h4>Adolescent's Name</h4>
          <input type="text" class="demo-input" id="adolescentName" placeholder="Enter name">
        </div>
        <div class="demo-card">
          <h4>Clinician's Name</h4>
          <input type="text" class="demo-input" id="clinicianName" placeholder="Clinician name">
        </div>
        <div class="demo-card">
          <h4>Date</h4>
          <input type="date" class="demo-input" id="assessmentDate" value="<?php echo date('Y-m-d'); ?>">
        </div>
      </div>
    </div>
    
    <!-- Instructions -->
    <div class="instructions">
      <h3><i class="fas fa-info-circle"></i> Instructions</h3>
      <p>How often have you been bothered by each of the following symptoms <strong>during the past two weeks?</strong></p>
      <p>For each symptom, select the answer that best describes how you have been feeling.</p>
      
      <div class="time-frame">
        <h4><i class="fas fa-calendar-alt"></i> Remember:</h4>
        <p>Think about how you've felt <strong>over the past 14 days</strong> (not just today).</p>
      </div>
    </div>
    
    <!-- Current Score Display -->
    <div class="score-display" id="scoreDisplay">
      <div class="score-label">Current Total Score</div>
      <div class="score-value" id="currentScoreValue">0</div>
      <div class="score-label" id="currentInterpretation">No Depression</div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
    </div>
    
    <!-- Items Container -->
    <div class="items-container" id="itemsContainer">
      <!-- Items will be dynamically inserted here -->
    </div>
    
    <!-- Additional Questions -->
    <div class="additional-questions" id="additionalQuestions">
      <div class="additional-question">
        <div class="question-text">In the past year have you felt depressed or sad most days, even if you felt okay sometimes?</div>
        <div class="option-group">
          <div class="additional-option" data-value="yes" onclick="selectAdditionalOption(this, 'yearDepressed')">Yes</div>
          <div class="additional-option" data-value="no" onclick="selectAdditionalOption(this, 'yearDepressed')">No</div>
        </div>
      </div>
      
      <div class="additional-question">
        <div class="question-text">If you are experiencing any of the problems on this form, how difficult have these problems made it for you to do your work, take care of things at home or get along with other people?</div>
        <div class="option-group">
          <div class="additional-option" data-value="not" onclick="selectAdditionalOption(this, 'difficulty')">Not difficult at all</div>
          <div class="additional-option" data-value="somewhat" onclick="selectAdditionalOption(this, 'difficulty')">Somewhat difficult</div>
          <div class="additional-option" data-value="very" onclick="selectAdditionalOption(this, 'difficulty')">Very difficult</div>
          <div class="additional-option" data-value="extremely" onclick="selectAdditionalOption(this, 'difficulty')">Extremely difficult</div>
        </div>
      </div>
      
      <div class="additional-question">
        <div class="question-text">Has there been a time in the past month when you have had serious thoughts about ending your life?</div>
        <div class="option-group">
          <div class="additional-option" data-value="yes" onclick="selectAdditionalOption(this, 'monthSuicide')">Yes</div>
          <div class="additional-option" data-value="no" onclick="selectAdditionalOption(this, 'monthSuicide')">No</div>
        </div>
      </div>
      
      <div class="additional-question">
        <div class="question-text">Have you EVER, in your WHOLE LIFE, tried to kill yourself or made a suicide attempt?</div>
        <div class="option-group">
          <div class="additional-option" data-value="yes" onclick="selectAdditionalOption(this, 'lifetimeAttempt')">Yes</div>
          <div class="additional-option" data-value="no" onclick="selectAdditionalOption(this, 'lifetimeAttempt')">No</div>
        </div>
      </div>
    </div>
    
    <!-- Critical Warning -->
    <div class="suicide-warning" style="margin-top: 20px;">
      <i class="fas fa-exclamation-triangle"></i>
      <strong>Important:</strong> If you have had thoughts that you would be better off dead or of hurting yourself in some way, please discuss this with your Health Care Clinician, go to a hospital emergency room or call 911.
    </div>
    
    <!-- Controls -->
    <div class="controls" id="controls">
      <button class="control-btn prev-btn" id="prevBtn" onclick="prevItem()">
        <i class="fas fa-arrow-left"></i> Previous
      </button>
      <button class="control-btn next-btn" id="nextBtn" onclick="nextItem()">
        Next <i class="fas fa-arrow-right"></i>
      </button>
      <button class="control-btn submit-btn" id="submitBtn" onclick="submitAssessment()">
        <i class="fas fa-paper-plane"></i> Complete Assessment
      </button>
    </div>
    
    <!-- Results -->
    <div class="results-container" id="resultsContainer">
      <div class="results-header">
        <i class="fas fa-clipboard-check" style="font-size: 2.5rem; color: var(--primary-color); margin-bottom: 15px;"></i>
        <h2>PHQ-A Assessment Results</h2>
        <p>Patient Health Questionnaire for Adolescents - Depression Screening</p>
      </div>
      
      <div class="final-score-circle" id="finalScoreCircle">
        <div class="score-number" id="finalScoreNumber">0</div>
        <div class="score-total">/27</div>
      </div>
      
      <div class="interpretation" id="interpretation">
        <!-- Will be filled dynamically -->
      </div>
      
      <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;"><i class="fas fa-chart-bar"></i> Depression Severity</h3>
      <div class="severity-scale">
        <div class="severity-card" style="background: rgba(76, 175, 80, 0.1); border: 2px solid var(--none);">
          <div class="severity-range" style="color: var(--none);">0-4</div>
          <div class="severity-label" style="color: var(--none);">Minimal or None</div>
        </div>
        <div class="severity-card" style="background: rgba(139, 195, 74, 0.1); border: 2px solid var(--minimal);">
          <div class="severity-range" style="color: var(--minimal);">5-9</div>
          <div class="severity-label" style="color: var(--minimal);">Mild Depression</div>
        </div>
        <div class="severity-card" style="background: rgba(255, 193, 7, 0.1); border: 2px solid var(--mild);">
          <div class="severity-range" style="color: var(--mild);">10-14</div>
          <div class="severity-label" style="color: var(--mild);">Moderate Depression</div>
        </div>
        <div class="severity-card" style="background: rgba(255, 152, 0, 0.1); border: 2px solid var(--moderate);">
          <div class="severity-range" style="color: var(--moderate);">15-19</div>
          <div class="severity-label" style="color: var(--moderate);">Moderately Severe Depression</div>
        </div>
        <div class="severity-card" style="background: rgba(244, 67, 54, 0.1); border: 2px solid var(--severe);">
          <div class="severity-range" style="color: var(--severe);">20-27</div>
          <div class="severity-label" style="color: var(--severe);">Severe Depression</div>
        </div>
      </div>
      
      <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;"><i class="fas fa-chart-pie"></i> Symptom Analysis</h3>
      <div class="symptom-analysis" id="symptomAnalysis">
        <!-- Will be filled dynamically -->
      </div>
      
      <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;"><i class="fas fa-heartbeat"></i> Clinical Recommendations</h3>
      <div class="recommendations-grid" id="recommendationsGrid">
        <!-- Will be filled dynamically -->
      </div>
      
      <div class="actions">
        <button class="action-btn retake-btn" onclick="retakeAssessment()">
          <i class="fas fa-redo"></i> New Assessment
        </button>
        <button class="action-btn print-btn" onclick="printResults()">
          <i class="fas fa-print"></i> Print Report
        </button>
      </div>
    </div>
  </div>

  <script>
    // PHQ-A Items Data (9 items, scored 0-3)
    const phqItems = [
      {
        id: 1,
        text: "Feeling down, depressed, irritable, or hopeless?",
        options: [
          { score: 0, label: "Not at all" },
          { score: 1, label: "Several days" },
          { score: 2, label: "More than half the days" },
          { score: 3, label: "Nearly every day" }
        ]
      },
      {
        id: 2,
        text: "Little interest or pleasure in doing things?",
        options: [
          { score: 0, label: "Not at all" },
          { score: 1, label: "Several days" },
          { score: 2, label: "More than half the days" },
          { score: 3, label: "Nearly every day" }
        ]
      },
      {
        id: 3,
        text: "Trouble falling asleep, staying asleep, or sleeping too much?",
        options: [
          { score: 0, label: "Not at all" },
          { score: 1, label: "Several days" },
          { score: 2, label: "More than half the days" },
          { score: 3, label: "Nearly every day" }
        ]
      },
      {
        id: 4,
        text: "Poor appetite, weight loss, or overeating?",
        options: [
          { score: 0, label: "Not at all" },
          { score: 1, label: "Several days" },
          { score: 2, label: "More than half the days" },
          { score: 3, label: "Nearly every day" }
        ]
      },
      {
        id: 5,
        text: "Feeling tired, or having little energy?",
        options: [
          { score: 0, label: "Not at all" },
          { score: 1, label: "Several days" },
          { score: 2, label: "More than half the days" },
          { score: 3, label: "Nearly every day" }
        ]
      },
      {
        id: 6,
        text: "Feeling bad about yourself – or feeling that you are a failure, or that you have let yourself or your family down?",
        options: [
          { score: 0, label: "Not at all" },
          { score: 1, label: "Several days" },
          { score: 2, label: "More than half the days" },
          { score: 3, label: "Nearly every day" }
        ]
      },
      {
        id: 7,
        text: "Trouble concentrating on things like school work, reading, or watching TV?",
        options: [
          { score: 0, label: "Not at all" },
          { score: 1, label: "Several days" },
          { score: 2, label: "More than half the days" },
          { score: 3, label: "Nearly every day" }
        ]
      },
      {
        id: 8,
        text: "Moving or speaking so slowly that other people could have noticed? Or the opposite – being so fidgety or restless that you were moving around a lot more than usual?",
        options: [
          { score: 0, label: "Not at all" },
          { score: 1, label: "Several days" },
          { score: 2, label: "More than half the days" },
          { score: 3, label: "Nearly every day" }
        ]
      },
      {
        id: 9,
        text: "Thoughts that you would be better off dead, or of hurting yourself in some way?",
        isCritical: true,
        options: [
          { score: 0, label: "Not at all" },
          { score: 1, label: "Several days" },
          { score: 2, label: "More than half the days" },
          { score: 3, label: "Nearly every day" }
        ]
      }
    ];

    // Categories for analysis
    const phqCategories = {
      "Core Mood Symptoms": [1, 2],
      "Sleep & Appetite": [3, 4],
      "Energy & Fatigue": [5],
      "Self-Worth": [6],
      "Cognitive Symptoms": [7],
      "Psychomotor Symptoms": [8],
      "Suicidal Thoughts": [9]
    };

    // User responses for main items
    let userResponses = new Array(phqItems.length).fill(null);
    let currentItemIndex = 0;
    
    // Additional questions responses
    let additionalResponses = {
      yearDepressed: null,
      difficulty: null,
      monthSuicide: null,
      lifetimeAttempt: null
    };

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      renderCurrentItem();
      updateScoreDisplay();
      
      // Set today's date as default
      document.getElementById('assessmentDate').valueAsDate = new Date();
    });

    // Render current item
    function renderCurrentItem() {
      const container = document.getElementById('itemsContainer');
      const item = phqItems[currentItemIndex];
      
      // Create options HTML
      const optionsHTML = item.options.map(option => `
        <div class="response-option">
          <button class="option-btn ${userResponses[currentItemIndex] === option.score ? 'selected' : ''}"
                  onclick="selectOption(${option.score})">
            <div class="option-score">${option.score}</div>
            <div class="option-label">${option.label}</div>
          </button>
        </div>
      `).join('');
      
      // Special styling for critical items
      const itemClass = item.isCritical ? 'critical-item' : '';
      
      container.innerHTML = `
        <div class="item-group ${itemClass}">
          <div class="item-number">${item.id}</div>
          <div class="item-text">${item.text}</div>
          
          ${item.isCritical ? `
            <div class="suicide-warning">
              <i class="fas fa-exclamation-triangle"></i>
              <strong>Important:</strong> Please answer honestly. This information helps us provide appropriate support.
            </div>
          ` : ''}
          
          <div class="response-grid">
            ${optionsHTML}
          </div>
        </div>
      `;
      
      updateNavigation();
    }

    // Select option
    function selectOption(score) {
      userResponses[currentItemIndex] = score;
      renderCurrentItem();
      updateScoreDisplay();
    }

    // Select additional option
    function selectAdditionalOption(element, question) {
      const value = element.getAttribute('data-value');
      const parent = element.parentElement;
      
      // Remove selected class from all options in this group
      parent.querySelectorAll('.additional-option').forEach(opt => {
        opt.classList.remove('selected');
      });
      
      // Add selected class to clicked option
      element.classList.add('selected');
      
      // Store response
      additionalResponses[question] = value;
    }

    // Update navigation
    function updateNavigation() {
      document.getElementById('prevBtn').style.display = currentItemIndex === 0 ? 'none' : 'flex';
      document.getElementById('nextBtn').style.display = currentItemIndex === phqItems.length - 1 ? 'none' : 'flex';
      document.getElementById('submitBtn').style.display = currentItemIndex === phqItems.length - 1 ? 'flex' : 'none';
    }

    // Next item
    function nextItem() {
      if (currentItemIndex < phqItems.length - 1) {
        currentItemIndex++;
        renderCurrentItem();
        updateScoreDisplay();
      }
    }

    // Previous item
    function prevItem() {
      if (currentItemIndex > 0) {
        currentItemIndex--;
        renderCurrentItem();
        updateScoreDisplay();
      }
    }

    // Calculate total score
    function calculateTotalScore() {
      return userResponses.reduce((total, score) => {
        return total + (score !== null ? score : 0);
      }, 0);
    }

    // Get interpretation
    function getInterpretation(score) {
      if (score <= 4) {
        return {
          severity: "Minimal or None",
          description: `The adolescent's responses suggest minimal or no depressive symptoms. This is within the normal range for mood fluctuations.`,
          color: "#4caf50",
          clinicalAction: "None needed; routine follow-up",
          recommendations: [
            "Continue routine monitoring and healthy lifestyle habits",
            "Maintain open communication about feelings",
            "Schedule routine follow-up in 6-12 months"
          ]
        };
      } else if (score <= 9) {
        return {
          severity: "Mild Depression",
          description: `The adolescent reports mild depressive symptoms. These may represent adjustment issues or early signs of depression that warrant monitoring.`,
          color: "#8bc34a",
          clinicalAction: "Watchful waiting; repeat PHQ-A at follow-up",
          recommendations: [
            "Provide additional emotional support and validation",
            "Consider brief supportive counseling",
            "Monitor for changes in symptoms over next 2-4 weeks",
            "Encourage regular physical activity and social engagement"
          ]
        };
      } else if (score <= 14) {
        return {
          severity: "Moderate Depression",
          description: `The adolescent reports moderate depressive symptoms affecting daily functioning. Clinical evaluation and intervention are recommended.`,
          color: "#ffc107",
          clinicalAction: "Treatment plan, considering counseling, follow-up and/or medication",
          recommendations: [
            "Refer to mental health professional for comprehensive evaluation",
            "Consider cognitive-behavioral therapy (CBT)",
            "Weekly monitoring of symptoms and functioning",
            "Collaborate with school for academic support"
          ]
        };
      } else if (score <= 19) {
        return {
          severity: "Moderately Severe Depression",
          description: `The adolescent reports significant depressive symptoms causing substantial impairment. Active treatment is strongly recommended.`,
          color: "#ff9800",
          clinicalAction: "Active treatment with psychotherapy, medication, or combination",
          recommendations: [
            "Immediate referral to child/adolescent psychiatrist",
            "Consider evidence-based psychotherapy",
            "May warrant medication evaluation",
            "Develop safety plan and crisis resources"
          ]
        };
      } else {
        return {
          severity: "Severe Depression",
          description: `The adolescent reports severe depressive symptoms with substantial impairment in multiple areas. Urgent and intensive treatment is required.`,
          color: "#f44336",
          clinicalAction: "Immediate initiation of treatment and frequent monitoring. Consider combination therapy and possible hospitalization.",
          recommendations: [
            "Immediate comprehensive psychiatric evaluation",
            "Consider intensive outpatient or inpatient treatment",
            "Multimodal treatment including therapy and medication",
            "24/7 safety monitoring and crisis planning"
          ]
        };
      }
    }

    // Get suicide risk assessment
    function getSuicideAssessment() {
      const suicideScore = userResponses[8]; // Item 9 (index 8)
      const monthSuicide = additionalResponses.monthSuicide;
      const lifetimeAttempt = additionalResponses.lifetimeAttempt;
      
      let level = "Low Risk";
      let description = "";
      let critical = false;
      
      // Primary risk factors
      if (suicideScore >= 2) { // More than half the days or nearly every day
        level = "High Risk";
        description = "Frequent suicidal thoughts reported. ";
        critical = true;
      } else if (suicideScore === 1) { // Several days
        level = "Moderate Risk";
        description = "Occasional suicidal thoughts reported. ";
        critical = true;
      }
      
      // Additional risk factors
      if (monthSuicide === "yes") {
        level = "High Risk";
        description += "Recent serious suicidal thoughts (past month). ";
        critical = true;
      }
      
      if (lifetimeAttempt === "yes") {
        level = "High Risk";
        description += "History of suicide attempt(s). ";
        critical = true;
      }
      
      if (!critical) {
        description = "No significant suicidal ideation reported.";
      }
      
      return { level, description, critical };
    }

    // Update score display
    function updateScoreDisplay() {
      const score = calculateTotalScore();
      const interpretation = getInterpretation(score);
      
      document.getElementById('currentScoreValue').textContent = score;
      document.getElementById('currentInterpretation').textContent = interpretation.severity;
      document.getElementById('currentInterpretation').style.color = interpretation.color;
      
      // Update progress bar
      const progress = (score / 27) * 100; // Max possible score is 27
      document.getElementById('progressFill').style.width = `${progress}%`;
      document.getElementById('progressFill').style.background = interpretation.color;
    }

    // Generate symptom analysis
    function generateSymptomAnalysis() {
      let html = '';
      
      for (const [category, itemIndices] of Object.entries(phqCategories)) {
        let categoryScore = 0;
        let itemCount = 0;
        
        itemIndices.forEach(index => {
          if (userResponses[index] !== null) {
            categoryScore += userResponses[index];
            itemCount++;
          }
        });
        
        const averageScore = itemCount > 0 ? categoryScore / itemCount : 0;
        
        let severity = "";
        let color = "#666";
        
        if (averageScore < 1) {
          severity = "Minimal";
          color = "#4caf50";
        } else if (averageScore < 2) {
          severity = "Mild";
          color = "#8bc34a";
        } else if (averageScore < 2.5) {
          severity = "Moderate";
          color = "#ffc107";
        } else {
          severity = "Severe";
          color = "#f44336";
        }
        
        html += `
          <div class="symptom-card">
            <h5>${category}</h5>
            <div class="symptom-score" style="color: ${color};">${categoryScore.toFixed(1)}</div>
            <div style="font-size: 0.85rem; color: #666; text-align: center;">
              ${severity} • ${itemCount} item(s)
            </div>
          </div>
        `;
      }
      
      return html;
    }

    // Submit assessment
    function submitAssessment() {
      const adolescentName = document.getElementById('adolescentName').value.trim();
      const clinicianName = document.getElementById('clinicianName').value.trim();
      const assessmentDate = document.getElementById('assessmentDate').value;
      
      if (!adolescentName) {
        alert("Please enter the adolescent's name before submitting.");
        return;
      }
      
      const totalScore = calculateTotalScore();
      const interpretation = getInterpretation(totalScore);
      const suicideAssessment = getSuicideAssessment();
      
      // Display final score
      document.getElementById('finalScoreNumber').textContent = totalScore;
      document.getElementById('finalScoreCircle').style.background = interpretation.color;
      
      // Update interpretation
      document.getElementById('interpretation').innerHTML = `
        <h3 style="color: ${interpretation.color}; margin-bottom: 15px;">
          <i class="fas fa-user-md"></i> Assessment: ${interpretation.severity}
        </h3>
        <p>${interpretation.description}</p>
        <div style="margin-top: 15px; padding: 12px; background: white; border-radius: 6px;">
          <strong>Total PHQ-A Score:</strong> ${totalScore}/27<br>
          <strong>Clinical Action Suggested:</strong> ${interpretation.clinicalAction}<br>
          <strong>Suicide Risk Level:</strong> ${suicideAssessment.level}<br>
          <strong>Assessment Date:</strong> ${new Date(assessmentDate).toLocaleDateString()}
        </div>
      `;
      
      // Generate symptom analysis
      document.getElementById('symptomAnalysis').innerHTML = generateSymptomAnalysis();
      
      // Generate recommendations
      generateRecommendations(interpretation, suicideAssessment);
      
      // Show results
      document.getElementById('itemsContainer').style.display = 'none';
      document.getElementById('additionalQuestions').style.display = 'none';
      document.getElementById('controls').style.display = 'none';
      document.getElementById('scoreDisplay').style.display = 'none';
      document.getElementById('resultsContainer').style.display = 'block';
      
      // Save results
      saveAssessmentResults(totalScore, interpretation, suicideAssessment, adolescentName, clinicianName);
    }

    // Generate recommendations
    function generateRecommendations(interpretation, suicideAssessment) {
      const container = document.getElementById('recommendationsGrid');
      let recommendations = [...interpretation.recommendations];
      
      // Add suicide-specific recommendations if needed
      if (suicideAssessment.critical) {
        recommendations.unshift({
          title: "Safety Planning",
          icon: "fas fa-shield-alt",
          description: `<strong>${suicideAssessment.level}:</strong> ${suicideAssessment.description} Immediate safety planning required with mental health professional.`
        });
        
        if (suicideAssessment.level === "High Risk") {
          recommendations.unshift({
            title: "Immediate Crisis Response",
            icon: "fas fa-ambulance",
            description: "High suicide risk detected. Requires immediate psychiatric evaluation and crisis intervention."
          });
        }
      }
      
      // Add PHQ-A specific recommendations
      recommendations.push(
        {
          title: "PHQ-A Follow-up",
          icon: "fas fa-redo",
          description: "Re-administer PHQ-A in 2-4 weeks to monitor treatment response and track symptom changes."
        },
        {
          title: "Family Involvement",
          icon: "fas fa-users",
          description: "Involve parents/guardians in treatment planning with appropriate confidentiality considerations."
        },
        {
          title: "School Collaboration",
          icon: "fas fa-school",
          description: "Coordinate with school personnel for academic support and monitoring of school functioning."
        },
        {
          title: "Adolescent-Friendly Resources",
          icon: "fas fa-mobile-alt",
          description: "Provide age-appropriate mental health resources and crisis hotlines designed for adolescents."
        }
      );
      
      // Render recommendations
      container.innerHTML = recommendations.map(rec => `
        <div class="recommendation-card">
          <h4><i class="${rec.icon}"></i> ${rec.title}</h4>
          <p>${rec.description}</p>
        </div>
      `).join('');
    }

    // Save assessment results
    function saveAssessmentResults(totalScore, interpretation, suicideAssessment, adolescentName, clinicianName) {
      const assessmentData = {
        test: "PHQ-9 Modified for Adolescents (PHQ-A)",
        date: new Date().toISOString(),
        adolescentName: adolescentName,
        clinicianName: clinicianName,
        totalScore: totalScore,
        maxScore: 27,
        severity: interpretation.severity,
        clinicalAction: interpretation.clinicalAction,
        suicideRisk: suicideAssessment.level,
        additionalResponses: additionalResponses,
        items: phqItems.map((item, index) => ({
          id: item.id,
          text: item.text,
          score: userResponses[index] !== null ? userResponses[index] : null
        }))
      };
      
      // Save to localStorage
      const assessments = JSON.parse(localStorage.getItem('phqA_Assessments') || '[]');
      assessments.push(assessmentData);
      localStorage.setItem('phqA_Assessments', JSON.stringify(assessments));
    }

    // Retake assessment
    function retakeAssessment() {
      userResponses = new Array(phqItems.length).fill(null);
      currentItemIndex = 0;
      additionalResponses = {
        yearDepressed: null,
        difficulty: null,
        monthSuicide: null,
        lifetimeAttempt: null
      };
      
      document.getElementById('itemsContainer').style.display = 'block';
      document.getElementById('additionalQuestions').style.display = 'block';
      document.getElementById('controls').style.display = 'flex';
      document.getElementById('scoreDisplay').style.display = 'block';
      document.getElementById('resultsContainer').style.display = 'none';
      
      // Clear additional question selections
      document.querySelectorAll('.additional-option').forEach(option => {
        option.classList.remove('selected');
      });
      
      renderCurrentItem();
      updateScoreDisplay();
    }

    // Print results
    function printResults() {
      const printContent = document.getElementById('resultsContainer').innerHTML;
      const originalContent = document.body.innerHTML;
      const adolescentName = document.getElementById('adolescentName').value || "Adolescent";
      const clinicianName = document.getElementById('clinicianName').value || "Clinician";
      
      document.body.innerHTML = `
        <div style="padding: 30px; font-family: Arial, sans-serif;">
          <h1 style="color: #0288d1; margin-bottom: 20px; border-bottom: 2px solid #0288d1; padding-bottom: 10px;">
            PHQ-A Assessment Report
          </h1>
          <div style="margin-bottom: 30px; color: #666;">
            <strong>Adolescent:</strong> ${adolescentName}<br>
            <strong>Clinician:</strong> ${clinicianName}<br>
            <strong>Assessment Date:</strong> ${new Date().toLocaleDateString('en-US', { 
              year: 'numeric', 
              month: 'long', 
              day: 'numeric'
            })}
          </div>
          ${printContent}
        </div>
      `;
      
      window.print();
      document.body.innerHTML = originalContent;
      location.reload();
    }

    // Keyboard navigation
    document.addEventListener('keydown', function(event) {
      if (event.key === 'ArrowRight' || event.key === ' ') {
        event.preventDefault();
        nextItem();
      } else if (event.key === 'ArrowLeft') {
        event.preventDefault();
        prevItem();
      } else if (event.key >= '0' && event.key <= '3') {
        event.preventDefault();
        const score = parseInt(event.key);
        selectOption(score);
      } else if (event.key === 'Enter' && currentItemIndex === phqItems.length - 1) {
        event.preventDefault();
        submitAssessment();
      }
    });
  </script>
</body>
</html>